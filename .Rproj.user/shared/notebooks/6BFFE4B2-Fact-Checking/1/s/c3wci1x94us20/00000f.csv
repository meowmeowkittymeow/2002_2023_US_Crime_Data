"0","#| label: NYC stats"
"0","#| message: false"
"0",""
"0","# Reading in data"
"0","NYC_NYPD_2023_Murder_Rate_Path <- here(""Data_Raw"", ""seven-major-felony-offenses-2000-2023.xls"")"
"0",""
"0","NYC_NYPD_Murder_Rates <- read_excel(NYC_NYPD_2023_Murder_Rate_Path)"
"0",""
"0","# Removing headers and notes"
"0","NYC_NYPD_Murder_Rates <- NYC_NYPD_Murder_Rates[-c(1:2, 12:18), ]"
"0",""
"0","# Extracting and reassigning all column names"
"0","colnames(NYC_NYPD_Murder_Rates) <- as.character(NYC_NYPD_Murder_Rates[1, ])"
"0",""
"0","# Removing column names from row"
"0","NYC_NYPD_Murder_Rates <- NYC_NYPD_Murder_Rates[-c(1), ]"
"0",""
"0","# Converting to character for pivot"
"0","NYC_NYPD_Murder_Rates <- NYC_NYPD_Murder_Rates |> "
"0","  mutate(across(starts_with(""20""), as.character))"
"0",""
"0","# Pivoting data to make years cases and crimes variables"
"0","NYC_NYPD_Murder_Rates <- NYC_NYPD_Murder_Rates |>"
"0","  pivot_longer("
"0","    cols = starts_with(""20""),  # Columns starting with years (not applying following to offense)"
"0","    names_to = ""Year"",         # Name for the new year column"
"0","    values_to = ""Count""        # Name for the new count column"
"0","  )"
"0",""
"0","NYC_NYPD_Murder_Rates$Year <- gsub(""[^0-9]"", """", NYC_NYPD_Murder_Rates$Year)"
"0",""
"0","NYC_NYPD_Murder_Rates$Year <- as.numeric(NYC_NYPD_Murder_Rates$Year)"
"0",""
"0","NYC_NYPD_Murder_Rates <- NYC_NYPD_Murder_Rates |>"
"0","  pivot_wider("
"0","    names_from = OFFENSE,  # Crime types become columns"
"0","    values_from = Count    # Values filled in with counts"
"0","  )"
"0",""
"0","NYC_NYPD_Murder_Rates <- NYC_NYPD_Murder_Rates |>"
"0","  rename(Murders = `MURDER & NON-NEGL. MANSLAUGHTER`) |>"
"0","    select(Year, Murders)"
"0",""
"0","# Adding population to to determine murder rate"
"0","NYC_NYPD_Murder_Rates$Population_2020 <- as.numeric(NYC_Population_2020)"
"0","NYC_NYPD_Murder_Rates$Population_2023 <- as.numeric(NYC_Population_2023)"
"0",""
"0","NYC_NYPD_Murder_Rates_2020 <- NYC_NYPD_Murder_Rates |>"
"0","  filter(Year == 2020) |>"
"0","  mutate("
"0","    Murders_2020 = as.numeric(Murders),"
"0","    Murder_Rate_2020 = Murders_2020 / Population_2020"
"0","  ) |>"
"0","  select(Year, Murders, Population_2020, Murder_Rate_2020) |>"
"0","  rename(Murders_2020 = Murders) |>"
"0","  select(-Year)"
"0",""
"0","NYC_NYPD_Murder_Rates_2023 <- NYC_NYPD_Murder_Rates |>"
"0","  filter(Year == 2023) |>"
"0","  mutate("
"0","    Murders_2023 = as.numeric(Murders),"
"0","    Murder_Rate_2023 = Murders_2023 / Population_2023"
"0","  ) |>"
"0","  select(Year, Murders, Population_2023, Murder_Rate_2023) |>"
"0","  rename(Murders_2023 = Murders) |>"
"0","  select(-Year)"
"0",""
"0","Change_Murder_Rates_NYC_NYPD <- bind_cols(NYC_NYPD_Murder_Rates_2020, NYC_NYPD_Murder_Rates_2023)"
"0",""
"0","# Adding city name"
"0","Change_Murder_Rates_NYC_NYPD$City <- ""New York, New York"""
"0",""
"0","# Adding change of rate variable"
"0","Change_Murder_Rates_NYC_NYPD <- Change_Murder_Rates_NYC_NYPD |>"
"0","  mutate(Change_Murder_Rate_2020_2023 = (Murder_Rate_2023 - Murder_Rate_2020) / Murder_Rate_2020,"
"0",")"
